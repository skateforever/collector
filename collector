#!/bin/bash
#######################################################
#                                                     #
# collector is my script for reconnaissance during    #
# my job as pentester or as a hobby doing bug bounty  #
#                                                     #
#######################################################

collector_command_line="$0 $*"
collector_path=$(dirname "$0")

[[ -s "${collector_path}/functions/banner.sh" ]] && source "${collector_path}/functions/banner.sh"
banner

if [ -s "${collector_path}/collector.cfg" ]; then
    source "${collector_path}/collector.cfg"
else
    banner
    echo -e "Please ${red}make sure${reset} you have the ${yellow}collector.cfg${reset} file."
    echo -e "${yellow}You need this to set the tools parameters${reset}!"
    echo -e "You will set aquatone, gobuster, dirsearch threads and others.\n"
    exit 1
fi

# Checking if the essencial functions there are
for file in kill_collector.sh check_binaries.sh usage.sh message.sh menu.sh check_structure.sh check_execution.sh \
    domains_sources.sh files.sh diff.sh infra.sh webapp_crawler.sh webapp_discovery.sh webapp_scan.sh webapp_enum.sh git.sh \
    domains_recon.sh url_recon.sh collector_exec.sh; do
    function="${collector_path}/functions/${file}"
    if [ -s "${function}" ]; then
        source "${function}"
    else
        echo -e "Please ${red}make sure${reset} you have the ${yellow}\"${function}\"${reset} file."
        echo -e "${yellow}You need this file to execute collector${reset}!"
        echo -e "The collector execution ${red}failed${reset} at ${yellow}$(date +"%Y%m%d %H:%M")${reset} due missing essentials files!" 
        exit 1
    fi
done

check_binaries
check_execution "$@"
menu "$@"
check_parameter_dependency_domain
collector_exec
